<!DOCTYPE html>
<html lang="ko-KR">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>2부 - 성능 개선 | 끄적끄적 개발일지</title>
    <meta name="generator" content="VuePress 1.8.2">
    <script src="https://www.googletagmanager.com/gtag/js?id=G-SE0BLFFFMG"></script>
    <meta name="description" content="Awesome description">
    
    <link rel="preload" href="/assets/css/0.styles.4bffb705.css" as="style"><link rel="preload" href="/assets/js/app.70752fd1.js" as="script"><link rel="preload" href="/assets/js/17.4dcf5890.js" as="script"><link rel="preload" href="/assets/js/4.39bb3471.js" as="script"><link rel="prefetch" href="/assets/js/10.1fe66b22.js"><link rel="prefetch" href="/assets/js/11.3e8e6dd5.js"><link rel="prefetch" href="/assets/js/12.96743d99.js"><link rel="prefetch" href="/assets/js/13.5cab9bdd.js"><link rel="prefetch" href="/assets/js/14.e412fb10.js"><link rel="prefetch" href="/assets/js/15.1da5e3dc.js"><link rel="prefetch" href="/assets/js/16.8ebbd2f8.js"><link rel="prefetch" href="/assets/js/18.5bfa6a85.js"><link rel="prefetch" href="/assets/js/19.12bd999a.js"><link rel="prefetch" href="/assets/js/2.0c177ed1.js"><link rel="prefetch" href="/assets/js/20.87648ee0.js"><link rel="prefetch" href="/assets/js/21.7fbb071c.js"><link rel="prefetch" href="/assets/js/22.3f3676f6.js"><link rel="prefetch" href="/assets/js/23.114b4211.js"><link rel="prefetch" href="/assets/js/24.7077956a.js"><link rel="prefetch" href="/assets/js/25.42ad01f0.js"><link rel="prefetch" href="/assets/js/26.c356a4d4.js"><link rel="prefetch" href="/assets/js/27.52a125bd.js"><link rel="prefetch" href="/assets/js/28.692ecc68.js"><link rel="prefetch" href="/assets/js/29.d205c4cb.js"><link rel="prefetch" href="/assets/js/3.6ee8ed88.js"><link rel="prefetch" href="/assets/js/30.c221f26d.js"><link rel="prefetch" href="/assets/js/31.65e9c8ce.js"><link rel="prefetch" href="/assets/js/32.7ddfb0f5.js"><link rel="prefetch" href="/assets/js/33.7f74862d.js"><link rel="prefetch" href="/assets/js/34.21b19958.js"><link rel="prefetch" href="/assets/js/35.428cdea5.js"><link rel="prefetch" href="/assets/js/36.ef46a37e.js"><link rel="prefetch" href="/assets/js/37.290a8b87.js"><link rel="prefetch" href="/assets/js/38.61002123.js"><link rel="prefetch" href="/assets/js/39.fbbd1cce.js"><link rel="prefetch" href="/assets/js/40.ee500a11.js"><link rel="prefetch" href="/assets/js/41.ce50acc7.js"><link rel="prefetch" href="/assets/js/42.b0e56f29.js"><link rel="prefetch" href="/assets/js/43.c4683cd4.js"><link rel="prefetch" href="/assets/js/44.4fd9959c.js"><link rel="prefetch" href="/assets/js/45.10201422.js"><link rel="prefetch" href="/assets/js/5.6b61195e.js"><link rel="prefetch" href="/assets/js/6.d4a6ae6d.js"><link rel="prefetch" href="/assets/js/7.8da69c67.js"><link rel="prefetch" href="/assets/js/8.8044f9c2.js"><link rel="prefetch" href="/assets/js/9.8e23472b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.4bffb705.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div data-app="true" id="app" class="v-application v-application--is-ltr theme--light" style="background:#F3F5F7;"><div class="v-application--wrap"><div class="container pa-0" style="max-width:900px;"><link href="https://fonts.googleapis.com/css?family=Jura" rel="stylesheet"> <div class="text-center py-8 v-toolbar__title v-app-bar-title" style="font-family:'Jura';"><div class="v-app-bar-title__content"><h1 class="primary--text">끄적끄적 개발일지</h1></div><div class="v-app-bar-title__placeholder" style="visibility:visible;"><h1 class="primary--text">끄적끄적 개발일지</h1></div></div> <div role="list" class="v-list pa-0 v-sheet theme--light v-list--flat transparent"><div role="listbox" class="v-item-group theme--light v-list-item-group indigo--text"><div class="row mb-0 text-center no-gutters justify-center"><div class="col-lg-2 col"><a href="/" tabindex="0" block="" text="" role="option" aria-selected="false" class="py-2  v-list-item v-list-item--link theme--light primary--text"><div class="v-list-item__title">Home</div></a></div> <div class="col-lg-2 col"><a href="/category" aria-current="page" tabindex="0" block="" text="" role="option" aria-selected="false" class="py-2 v-item--active v-list-item--active v-list-item v-list-item--link theme--light primary--text"><div class="v-list-item__title">Category</div></a></div> <div class="col-lg-2 col"><a href="/profiles" tabindex="0" block="" text="" role="option" aria-selected="false" class="py-2 v-list-item v-list-item--link theme--light primary--text"><div class="v-list-item__title">Profiles</div></a></div></div></div></div> <hr role="separator" aria-orientation="horizontal" class="mb-3 v-divider theme--light"> <div><div data-v-52bca676><div class="px-0 col col-12" data-v-52bca676 data-v-52bca676><div class="pa-5 px-md-7 v-card v-sheet theme--light elevation-1" data-v-52bca676><div data-v-52bca676><a href="/category/learn-tuning/ch2.html" aria-current="page" class="text-h4 font-weight-bold router-link-exact-active router-link-active" data-v-52bca676><div data-v-52bca676><!----></div>
          2부 - 성능 개선
        </a> <br data-v-52bca676> <span class="text-caption grey--text text--darken-1 " data-v-52bca676>2022-02-04 &gt; 실무로 배우는 시스템 성능 최적화
        </span></div> <hr role="separator" aria-orientation="horizontal" class="mt-4 mb-4 v-divider theme--light" data-v-52bca676> <div class="theme-container" data-v-52bca676><div class="toc" data-v-52bca676><ul><li><a href="/category/learn-tuning/ch2.html#_1장-기본-자세">1장. 기본 자세</a></li><li><a href="/category/learn-tuning/ch2.html#_2장-성능-분석-시작하기">2장. 성능 분석 시작하기</a><ul><li><a href="/category/learn-tuning/ch2.html#_2-1-애플리케이션-서버-응답시간-분석">2.1 애플리케이션 서버 응답시간 분석</a></li><li><a href="/category/learn-tuning/ch2.html#_2-2-클라이언트-응답시간-분석">2.2 클라이언트 응답시간 분석</a></li></ul></li><li><a href="/category/learn-tuning/ch2.html#_3장-상황별-분석-단계">3장. 상황별 분석 단계</a><ul><li><a href="/category/learn-tuning/ch2.html#_3-1-화면-응답시간-저하">3.1 화면 응답시간 저하</a></li><li><a href="/category/learn-tuning/ch2.html#_3-2-시스템-내-응답시간-저하">3.2 시스템 내 응답시간 저하</a></li><li><a href="/category/learn-tuning/ch2.html#_3-3-서비스-멈춤-현상">3.3 서비스 멈춤 현상</a></li><li><a href="/category/learn-tuning/ch2.html#_3-4-시스템-전반에-걸친-성능-개선">3.4 시스템 전반에 걸친 성능 개선</a></li><li><a href="/category/learn-tuning/ch2.html#_3-5-서버-자원-사용량-확인">3.5 서버 자원 사용량 확인</a></li><li><a href="/category/learn-tuning/ch2.html#_3-6-cpu-과다-사용-분석">3.6 CPU 과다 사용 분석</a></li><li><a href="/category/learn-tuning/ch2.html#_3-7-메모리-과다-사용-분석">3.7 메모리 과다 사용 분석</a></li><li><a href="/category/learn-tuning/ch2.html#_3-8-디스크-과다-사용-분석">3.8 디스크 과다 사용 분석</a></li></ul></li><li><a href="/category/learn-tuning/ch2.html#_4-개선-방향성">4.개선 방향성</a></li></ul></div> <div class="theme-default-content custom post markdown-body content__default" data-v-52bca676><h2 id="_1장-기본-자세"><a href="#_1장-기본-자세" class="header-anchor">#</a> 1장. 기본 자세</h2> <ul><li>적극적이고 도전적인 자세를 갖춰라</li> <li>다른 사람의 설명과 의견에 귀 기울여라</li> <li>종합적인 시각을 가져라</li> <li>실행하고 비교하라</li></ul> <h2 id="_2장-성능-분석-시작하기"><a href="#_2장-성능-분석-시작하기" class="header-anchor">#</a> 2장. 성능 분석 시작하기</h2> <ul><li>클라이언트부터 시작해 웹 서버, 애플리케이션 서버, DB 서버 등 여러 서버를 거쳐서 동작한다.</li> <li>이런 구성에서 성능 저하가 발생했을 땐 네트워크를 기준으로 각 서버가 전체 응답시간에서 차지하는 비중을 분석해 영향도가 큰 집중 분석 대상을 선정하는 것 이다.</li> <li>성능이 저하됐을 때 처리 지연이 발생한 위치가 대부분 시스템 내부인 경우가 많기 때문에 내부 처리시간이 사용자 체감 응답시간과 차이가 있는지 확인하는 것이 우선이다.</li></ul> <h3 id="_2-1-애플리케이션-서버-응답시간-분석"><a href="#_2-1-애플리케이션-서버-응답시간-분석" class="header-anchor">#</a> 2.1 애플리케이션 서버 응답시간 분석</h3> <ul><li>애플리케이션 서버 내부에서 세분화된 응답시간을 얻는 방법에는 세 가지가 있다.
<ul><li><strong>APM</strong> <ul><li>가장 손쉽게 직관적인 데이터 수집이 가능, 단 프로파일링 설정이 많으면 APM 자체가 성능 저하의 원인이 되기도 한다.</li></ul></li> <li><strong>스택 수집</strong> <ul><li>주기적으로 스택을 수십 회 이상 수집해서 분석하는 방법</li> <li>현재 통신 소켓을 읽거나 쓰고 있는 스택 하위에 있는 연계 인터페이스 메서드를 식별해 각 구성 요소 응답시간 비중을 분석할 수 있다.</li></ul></li> <li><strong>프레임워크 로깅</strong> <ul><li>프레임워크 내부에서 각 구성 요소에서 소요된 처리시간을 서비스 요청 단위로 로깅하는 기능을 포함시키는 것이다.</li></ul></li></ul></li></ul> <h3 id="_2-2-클라이언트-응답시간-분석"><a href="#_2-2-클라이언트-응답시간-분석" class="header-anchor">#</a> 2.2 클라이언트 응답시간 분석</h3> <ul><li>클라이언트단 단에서 사용자 응답시간을 분석할 때 다음과 같이 나눠서 분석한다.
<ul><li><strong>클라이언트 처리시간, 네트워크 처리시간, 서버 처리시간 (+ DNS 룩업시간)</strong></li></ul></li></ul> <h2 id="_3장-상황별-분석-단계"><a href="#_3장-상황별-분석-단계" class="header-anchor">#</a> 3장. 상황별 분석 단계</h2> <h3 id="_3-1-화면-응답시간-저하"><a href="#_3-1-화면-응답시간-저하" class="header-anchor">#</a> 3.1 화면 응답시간 저하</h3> <p><img src="/assets/img/img.a257c0f2.png" alt=""></p> <ol><li><strong>클라이언트의 자원 사용량 확인</strong></li></ol> <ul><li>클라이언트 PC의 주요 자원이 화면을 테스트하는 데 영향을 줄 가능성이 있는지 확인한다.</li> <li>프로세스, 프로세스해커 등</li></ul> <ol start="2"><li><strong>사용자 접점 서버단 패킷 수집</strong></li></ol> <ul><li>성능 저하가 특정 사용자에게 발생하지만 사용자 PC에서 직접 모니터링이 불가능한 경우 서버단에서 클라이언트 응답시간을 분석하기 위해 패킷을 수집한다.</li> <li>tcpdump, 와이어샤크 등</li></ul> <ol start="3"><li><strong>클라이언트 응답시간 분석</strong></li></ol> <ul><li>클라이언트 응답시간을 클라이언트, 네트워크, 서버 세 구간으로 나눠서 분석한다.</li></ul> <ol start="4"><li><strong>클라이언트 원인 분석</strong></li></ol> <ul><li>클라이언트에서 소요되는 시간이 많은 경우 원인을 분석한다.</li> <li>클라이언트 스크립트 로직과 렌더링을 구분해서 분석</li> <li>콘텐츠 유형과 응답시간 상관관계 분석</li> <li>화면 처리 흐름으로 인한 애플리케이션 턴 수</li> <li>HTML 내 자바스크립트와 CSS에 의한 렌더링 영향도 분석</li> <li>클라이언트 로킹 영향도 확인</li> <li>클라이언트 캐시 동작 여부 확인</li> <li>콘텐츠 구성 방식과 크기</li></ul> <ol start="5"><li><strong>네트워크 원인 분석</strong></li></ol> <ul><li>전체 응답시간 중 네트워크에서 소요되는 시간이 많을 때 원인을 분석한다.</li> <li>전송 데이터 : 전송 데이터 크기, 콘텐츠 수, 전문 형태, 압축 여부</li> <li>통신 방식 : 프로토콜 네트워크 연결 유지 및 연결 수, 네트워크 턴 수</li> <li>통신 품질 : 패킷 왕복시간, 재전송, 전송 대역폭</li></ul> <h3 id="_3-2-시스템-내-응답시간-저하"><a href="#_3-2-시스템-내-응답시간-저하" class="header-anchor">#</a> 3.2 시스템 내 응답시간 저하</h3> <p><img src="/assets/img/img_1.f86dcdbd.png" alt=""></p> <ol><li><strong>애플리케이션 서버 응답시간 분석</strong></li></ol> <ul><li>서버 내 애플리케이션 프로세스를 대상으로 스택을 분석한다.</li> <li>예를 들어 사용자 요청을 처리 중인 스택이 총 100개이고 그중 64개가 SQL을 수행 중이고, 20개가 로그 라면 SQL은 65%, 로깅은 20% 비중을 차지하고 있다고 불 수 있다.</li> <li>클라이언트 응답이 느린데 애플리케이션 서버 응답이 빠르다면 채널단이나 웹 서버가 느린것으로 판단할 수 있다.</li></ul> <ol start="2"><li><strong>채널/웹 서버 원인 분석</strong></li></ol> <ul><li>웹 서버에서 애플리케이션 서버로 작업을 즉시 넘기지 못하는 원인을 찾는다.</li> <li>서비스 스레드 부족 같은 병목 발생 여부를 확인하고, 웹 서버와 애플리케이션 서버 간 인터페이스 항목과 방식에 대해 분석을 진행한다.
<ul><li>병목발생 : 큐잉 여부, 작업 중인 스레드 수, 접속 클라이언트 수, 웹 KeepAlive 여부와 설정 시간</li> <li>인터페이스 : 웹 서버와 애플리케이션 서버 간 동작 분석, 콘텐츠 유형별 서비스 담당 서버 확인, 일부 애플리케이션 서버가 비정상적으로 동작할 경우 웹 서버 서비스 분해 확인</li></ul></li> <li>netstat, jstack, pstack 등</li></ul> <ol start="3"><li><strong>DB 원인 분석</strong></li></ol> <ul><li>SQL 응답시간이 느린 원인을 분석한다.</li> <li>락 대기 유무, 실행계획, 수행 통계를 바탕으로 원인 분석</li> <li>동작 중인 세션 : 현재 SQL을 수행 중인 세션의 상태(대기 이벤트)</li> <li>락 대기 : 수행 중인 SQL 간 락 영향도를 확인(락 트리)</li> <li>실행계획 : 저성능 SQL의 실행계획 및 실행 통계 확인</li> <li>수행 통계 : DB 운영 통계</li></ul> <ol start="4"><li><strong>연계 서버 원인 분석</strong></li></ol> <ul><li>타 시스템 서비스를 호출하므로 이를 내부와 외부로 구분해 처리시간을 측정하는 것</li></ul> <ol start="5"><li><strong>애플리케이션 내부 원인 분석</strong></li></ol> <ul><li>애플리케이션 내부 코드에서 발생한 성능 저하 원인을 분석할 때는 수집된 스택이 핵심 자료다.</li> <li>병목 빌셍 : 스레드 풀, DB 연결 풀 상태(부족 여부 확인)</li> <li>불필요한 작업 : 로깅과 모니터링, 환경 반복 로딩 등</li> <li>비효율적인 로직 : 업무 로직, 탐색 로직, 날짜/수치 연산 로직, 문자열 처리 로직</li> <li>SQL 수행 패턴 분석 : 서비스당 SQL 수행 유형과 횟수, 바인딩 변수를 기준으로 한 반복 수행 여부 분석</li> <li>SQL 수행로그, jstack, pstack, SDPA(분석)</li></ul> <h3 id="_3-3-서비스-멈춤-현상"><a href="#_3-3-서비스-멈춤-현상" class="header-anchor">#</a> 3.3 서비스 멈춤 현상</h3> <p><img src="/assets/img/img_2.a91def52.png" alt=""></p> <ul><li>프로세스가 멈춘 상태로 더 이상 사용자 요청을 처리하지 못하는 경우에도 자원 부족 여부를 먼저 확인한 후 애플리케이션 상태를 확인한다.</li> <li>서버 자원은 CPU 사용량과 메모리 스와핑 여부를 확인한다.</li> <li>DB 서버는 데이터 캐시 영역이 스왑 영역으로 내라가면 급격한 성능 저하가 발생한다.</li> <li>자바 프로세스는 연속 Full GC로 인해 멈춤 상태에 있을 수도 있으므로 GC 상태를 모니터링해야 한다.</li> <li>자원에 문제가 없다면 애플리케이션 스택을 분석한다.
<ul><li>락 영향도와 현재 수행중인 기능</li> <li>작업 스레드 소진 등</li></ul></li></ul> <h3 id="_3-4-시스템-전반에-걸친-성능-개선"><a href="#_3-4-시스템-전반에-걸친-성능-개선" class="header-anchor">#</a> 3.4 시스템 전반에 걸친 성능 개선</h3> <ul><li>전체 수행시간이 긴 애플리케이션과 SQL이 시스템 자원을 가장 많이 사용한다고 볼 수 있기에 개선 효과도 크게 나ㅏ난다.</li> <li>애플리케이션과 SQL 모두 수행 빈도와 총 수행시간이라는 두 가지 측면에서 비중이 가장 높은 것부터 개선 가능성을 검토한다.
<ul><li>응용 수행시간 총합 Top 10</li> <li>응숑 수행 횟수 Top 10</li> <li>SQL CPU 사용 총합 Top 10</li> <li>SQL 수행시간 총합 Top 10</li></ul></li></ul> <h3 id="_3-5-서버-자원-사용량-확인"><a href="#_3-5-서버-자원-사용량-확인" class="header-anchor">#</a> 3.5 서버 자원 사용량 확인</h3> <p><img src="/assets/img/img_3.19937ffa.png" alt=""></p> <h3 id="_3-6-cpu-과다-사용-분석"><a href="#_3-6-cpu-과다-사용-분석" class="header-anchor">#</a> 3.6 CPU 과다 사용 분석</h3> <p><img src="/assets/img/img_4.d4e3d7ac.png" alt=""></p> <ol><li><strong>특정 프로세스 CPU 과다 사용 작업 분석</strong></li></ol> <ul><li>특정 프로세스가 CPU를 많이 사용하게 만드는 기능과 소스코드를 식별해 개선 가능성을 검토한다.</li></ul> <ol start="2"><li><strong>시스템 CPU 과다 사용 작업 분석</strong></li></ol> <ul><li>CPU를 조금씩 사용하는 프로세스가 많이 모여서 CPU 사용률이 높은 경우에는 perf, caliper 와 같은 CPU 프로파일링 도구를 사용해 시스템 전반적으로 CPU를 많이 사용하는 라이브러리 함수를 식별할 수 있다.</li></ul> <ol start="3"><li><strong>SQL 개선 가능성 검토</strong></li></ol> <ul><li>SQL 튜닝 : 실행계획 검토(사용 블록 감소), 통계 생성</li> <li>DB 튜닝 : DB 캐시, 테이블 입출력 분산, 동시 트랜잭션 확대</li> <li>애플리케이션 튜닝 : 불필요한 수행 제거, 조회 결과 캐시, SQL 통합</li> <li>오렌지 같은 SQL 튜닝 도구</li></ul> <h3 id="_3-7-메모리-과다-사용-분석"><a href="#_3-7-메모리-과다-사용-분석" class="header-anchor">#</a> 3.7 메모리 과다 사용 분석</h3> <p><img src="/assets/img/img_5.8686ac2e.png" alt=""></p> <h3 id="_3-8-디스크-과다-사용-분석"><a href="#_3-8-디스크-과다-사용-분석" class="header-anchor">#</a> 3.8 디스크 과다 사용 분석</h3> <p><img src="/assets/img/img_6.b6884c80.png" alt=""></p> <h2 id="_4-개선-방향성"><a href="#_4-개선-방향성" class="header-anchor">#</a> 4.개선 방향성</h2> <ul><li>병렬/분산 처리</li> <li>비동기 처리</li> <li>캐시</li> <li>집합 처리</li> <li>오버헤드 제거</li> <li>경합 제거</li> <li>SQL 개선</li> <li>송수신 효율화</li> <li>자원 사용 효율화</li> <li>물리적인 자원 증설</li></ul></div></div></div></div> <div data-v-52bca676></div></div></div></div> <footer prime="" class="v-footer mt-2 v-sheet theme--light v-footer--padless" style="background:#F3F5F7;"><div class="col col-12"><div class="text-center v-card v-card--flat v-sheet theme--light rounded-0" style="background:#F3F5F7;"><div class="v-card__text"><p>Copyright © 2021 All Right <em>끄적끄적 개발일지</em></p> <p>
          px201226@gmail.com .
          <a href="https://github.com/px201226" target="_blank">GitHub</a>
          .
          <a href="http://px201226.github.io/blog" target="_blank">Blog</a>
          .
        </p></div></div></div></footer></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.70752fd1.js" defer></script><script src="/assets/js/17.4dcf5890.js" defer></script><script src="/assets/js/4.39bb3471.js" defer></script>
  </body>
</html>
