<!DOCTYPE html>
<html lang="ko-KR">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>4부 - 프로세스 이해하기 | 끄적끄적 개발일지</title>
    <meta name="generator" content="VuePress 1.8.2">
    <script src="https://www.googletagmanager.com/gtag/js?id=G-SE0BLFFFMG"></script>
    <meta name="description" content="Awesome description">
    
    <link rel="preload" href="/assets/css/0.styles.4bffb705.css" as="style"><link rel="preload" href="/assets/js/app.70752fd1.js" as="script"><link rel="preload" href="/assets/js/17.4dcf5890.js" as="script"><link rel="preload" href="/assets/js/16.8ebbd2f8.js" as="script"><link rel="prefetch" href="/assets/js/10.1fe66b22.js"><link rel="prefetch" href="/assets/js/11.3e8e6dd5.js"><link rel="prefetch" href="/assets/js/12.96743d99.js"><link rel="prefetch" href="/assets/js/13.5cab9bdd.js"><link rel="prefetch" href="/assets/js/14.e412fb10.js"><link rel="prefetch" href="/assets/js/15.1da5e3dc.js"><link rel="prefetch" href="/assets/js/18.5bfa6a85.js"><link rel="prefetch" href="/assets/js/19.12bd999a.js"><link rel="prefetch" href="/assets/js/2.0c177ed1.js"><link rel="prefetch" href="/assets/js/20.87648ee0.js"><link rel="prefetch" href="/assets/js/21.7fbb071c.js"><link rel="prefetch" href="/assets/js/22.3f3676f6.js"><link rel="prefetch" href="/assets/js/23.114b4211.js"><link rel="prefetch" href="/assets/js/24.7077956a.js"><link rel="prefetch" href="/assets/js/25.42ad01f0.js"><link rel="prefetch" href="/assets/js/26.c356a4d4.js"><link rel="prefetch" href="/assets/js/27.52a125bd.js"><link rel="prefetch" href="/assets/js/28.692ecc68.js"><link rel="prefetch" href="/assets/js/29.d205c4cb.js"><link rel="prefetch" href="/assets/js/3.6ee8ed88.js"><link rel="prefetch" href="/assets/js/30.c221f26d.js"><link rel="prefetch" href="/assets/js/31.65e9c8ce.js"><link rel="prefetch" href="/assets/js/32.7ddfb0f5.js"><link rel="prefetch" href="/assets/js/33.7f74862d.js"><link rel="prefetch" href="/assets/js/34.21b19958.js"><link rel="prefetch" href="/assets/js/35.428cdea5.js"><link rel="prefetch" href="/assets/js/36.ef46a37e.js"><link rel="prefetch" href="/assets/js/37.290a8b87.js"><link rel="prefetch" href="/assets/js/38.61002123.js"><link rel="prefetch" href="/assets/js/39.fbbd1cce.js"><link rel="prefetch" href="/assets/js/4.39bb3471.js"><link rel="prefetch" href="/assets/js/40.ee500a11.js"><link rel="prefetch" href="/assets/js/41.ce50acc7.js"><link rel="prefetch" href="/assets/js/42.b0e56f29.js"><link rel="prefetch" href="/assets/js/43.c4683cd4.js"><link rel="prefetch" href="/assets/js/44.4fd9959c.js"><link rel="prefetch" href="/assets/js/45.10201422.js"><link rel="prefetch" href="/assets/js/5.6b61195e.js"><link rel="prefetch" href="/assets/js/6.d4a6ae6d.js"><link rel="prefetch" href="/assets/js/7.8da69c67.js"><link rel="prefetch" href="/assets/js/8.8044f9c2.js"><link rel="prefetch" href="/assets/js/9.8e23472b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.4bffb705.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div data-app="true" id="app" class="v-application v-application--is-ltr theme--light" style="background:#F3F5F7;"><div class="v-application--wrap"><div class="container pa-0" style="max-width:900px;"><link href="https://fonts.googleapis.com/css?family=Jura" rel="stylesheet"> <div class="text-center py-8 v-toolbar__title v-app-bar-title" style="font-family:'Jura';"><div class="v-app-bar-title__content"><h1 class="primary--text">끄적끄적 개발일지</h1></div><div class="v-app-bar-title__placeholder" style="visibility:visible;"><h1 class="primary--text">끄적끄적 개발일지</h1></div></div> <div role="list" class="v-list pa-0 v-sheet theme--light v-list--flat transparent"><div role="listbox" class="v-item-group theme--light v-list-item-group indigo--text"><div class="row mb-0 text-center no-gutters justify-center"><div class="col-lg-2 col"><a href="/" tabindex="0" block="" text="" role="option" aria-selected="false" class="py-2  v-list-item v-list-item--link theme--light primary--text"><div class="v-list-item__title">Home</div></a></div> <div class="col-lg-2 col"><a href="/category" aria-current="page" tabindex="0" block="" text="" role="option" aria-selected="false" class="py-2 v-item--active v-list-item--active v-list-item v-list-item--link theme--light primary--text"><div class="v-list-item__title">Category</div></a></div> <div class="col-lg-2 col"><a href="/profiles" tabindex="0" block="" text="" role="option" aria-selected="false" class="py-2 v-list-item v-list-item--link theme--light primary--text"><div class="v-list-item__title">Profiles</div></a></div></div></div></div> <hr role="separator" aria-orientation="horizontal" class="mb-3 v-divider theme--light"> <div><div data-v-52bca676><div class="px-0 col col-12" data-v-52bca676 data-v-52bca676><div class="pa-5 px-md-7 v-card v-sheet theme--light elevation-1" data-v-52bca676><div data-v-52bca676><a href="/category/learn-tuning/ch4.html" aria-current="page" class="text-h4 font-weight-bold router-link-exact-active router-link-active" data-v-52bca676><div data-v-52bca676><!----></div>
          4부 - 프로세스 이해하기
        </a> <br data-v-52bca676> <span class="text-caption grey--text text--darken-1 " data-v-52bca676>2022-02-08 &gt; 실무로 배우는 시스템 성능 최적화
        </span></div> <hr role="separator" aria-orientation="horizontal" class="mt-4 mb-4 v-divider theme--light" data-v-52bca676> <div class="theme-container" data-v-52bca676><div class="toc" data-v-52bca676><ul><li><a href="/category/learn-tuning/ch4.html#_4부-프로세스-이해하기">4부 - 프로세스 이해하기</a></li><li><a href="/category/learn-tuning/ch4.html#_1-기본-방향">1. 기본 방향</a></li><li><a href="/category/learn-tuning/ch4.html#_2-수행-중인-코드">2. 수행 중인 코드</a><ul><li><a href="/category/learn-tuning/ch4.html#_2-1-스택에-대한-이해">2.1 스택에 대한 이해</a></li><li><a href="/category/learn-tuning/ch4.html#_2-2-스택-정보를-이용한-성능-분석">2.2 스택 정보를 이용한 성능 분석</a></li><li><a href="/category/learn-tuning/ch4.html#_2-3-스택-수집">2.3 스택 수집</a></li><li><a href="/category/learn-tuning/ch4.html#_2-4-프로세스-스택-분석-도구">2.4 프로세스 스택 분석 도구</a></li></ul></li><li><a href="/category/learn-tuning/ch4.html#_3-통신-파일-상태">3. 통신/파일 상태</a><ul><li><a href="/category/learn-tuning/ch4.html#_3-1-파일-지시자의-이해">3.1 파일 지시자의 이해</a></li><li><a href="/category/learn-tuning/ch4.html#_3-2-연계-통신-파일-상태-정보를-수집하는-방법">3.2 연계 통신/파일 상태 정보를 수집하는 방법</a></li></ul></li><li><a href="/category/learn-tuning/ch4.html#_4-통신-파일-간-동작">4. 통신/파일 간 동작</a><ul><li><a href="/category/learn-tuning/ch4.html#_4-1-시스템-콜에-대한-이해">4.1 시스템 콜에 대한 이해</a></li><li><a href="/category/learn-tuning/ch4.html#_4-2-통신-파일-상태와-동작-연계-분석">4.2 통신/파일 상태와 동작 연계 분석</a></li><li><a href="/category/learn-tuning/ch4.html#_4-3-스택-정보와-통신-파일-간-동작-연계-분석">4.3 스택 정보와 통신/파일 간 동작 연계 분석</a></li><li><a href="/category/learn-tuning/ch4.html#_4-4-통신-파일-간-동작-모니터링-방법">4.4 통신/파일 간 동작 모니터링 방법</a></li></ul></li><li><a href="/category/learn-tuning/ch4.html#_5-기타">5. 기타</a><ul><li><a href="/category/learn-tuning/ch4.html#_5-1-프로그램-소스코드-보기">5.1 프로그램 소스코드 보기</a></li><li><a href="/category/learn-tuning/ch4.html#_5-2-바이너리-코어-덤프에서-자바-스택이나-힙-정보를-추출하는-방법">5.2 바이너리 코어 덤프에서 자바 스택이나 힙 정보를 추출하는 방법</a></li><li><a href="/category/learn-tuning/ch4.html#_5-3-프로세스의-현재-작업-디렉터리를-확인하는-법">5.3 프로세스의 현재 작업 디렉터리를 확인하는 법</a></li><li><a href="/category/learn-tuning/ch4.html#_5-4-프로르램에서-사용하는-공유-라이브러리-확인">5.4 프로르램에서 사용하는 공유 라이브러리 확인</a></li><li><a href="/category/learn-tuning/ch4.html#_5-5-프로세스-생성-관계-보기">5.5 프로세스 생성 관계 보기</a></li><li><a href="/category/learn-tuning/ch4.html#_5-6-프로세스의-수행-환경-확인">5.6 프로세스의 수행 환경 확인</a></li></ul></li></ul></div> <div class="theme-default-content custom post markdown-body content__default" data-v-52bca676><h2 id="_4부-프로세스-이해하기"><a href="#_4부-프로세스-이해하기" class="header-anchor">#</a> 4부 - 프로세스 이해하기</h2> <h2 id="_1-기본-방향"><a href="#_1-기본-방향" class="header-anchor">#</a> 1. 기본 방향</h2> <ul><li>애플리케이션 최적화를 하기 위해서 프로세스의 동작 방식을 이해해야 한다.</li> <li>프로세스 이해에 필요한 기본 지식으로 다음 세 가지가 있다.
<ul><li><strong>수행 중인 코드</strong> : 프로세스가 현재 어떤 함수를 수행하고 있는가?</li> <li><strong>통신/파일 상태</strong> : 프로세스가 통신으로 연계된 서버는 어디고, 어떤 파일을 열고 있는가?</li> <li><strong>통신/파일 간 동작 상태</strong> : 연계 서버 또는 파일에 입출력이 얼마나 자주 그리고 오래 이루어지는가?</li></ul></li> <li>이번 장에서는 운영체제에서 제공하는 분석 명령어를 바탕으로 프로세스의 현재 상태와 동작을 이해하는 법과 개선 하는 방법을 습득한다.</li></ul> <h2 id="_2-수행-중인-코드"><a href="#_2-수행-중인-코드" class="header-anchor">#</a> 2. 수행 중인 코드</h2> <h3 id="_2-1-스택에-대한-이해"><a href="#_2-1-스택에-대한-이해" class="header-anchor">#</a> 2.1 스택에 대한 이해</h3> <ul><li>현재 수행 중인 프로그램이 코드 중 어디를 수행하고 있는지 알고 싶을 때는 해당 프로그램의 스택 정보를 획득하면 알 수 있다.</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>leegisu<span class="token operator">&gt;</span> jstack <span class="token number">12341</span>

Full thread dump OpenJDK <span class="token number">64</span>-Bit Server VM <span class="token punctuation">(</span><span class="token number">11.0</span>.12+7-LTS mixed mode<span class="token punctuation">)</span>:

<span class="token string">&quot;http-nio-8080-Acceptor&quot;</span> <span class="token comment">#28 daemon prio=5 os_prio=31 cpu=0.55ms elapsed=23.70s tid=0x00007ff0a3232000 nid=0x14b03 runnable  [0x000000030b22f000]</span>
   java.lang.Thread.State: RUNNABLE
        at sun.nio.ch.ServerSocketChannelImpl.accept0<span class="token punctuation">(</span>java.base@11.0.12/Native Method<span class="token punctuation">)</span>
        at sun.nio.ch.ServerSocketChannelImpl.accept<span class="token punctuation">(</span>java.base@11.0.12/ServerSocketChannelImpl.java:533<span class="token punctuation">)</span>
        at sun.nio.ch.ServerSocketChannelImpl.accept<span class="token punctuation">(</span>java.base@11.0.12/ServerSocketChannelImpl.java:285<span class="token punctuation">)</span>
        at org.apache.tomcat.util.net.NioEndpoint.serverSocketAccept<span class="token punctuation">(</span>NioEndpoint.java:540<span class="token punctuation">)</span>
        at org.apache.tomcat.util.net.NioEndpoint.serverSocketAccept<span class="token punctuation">(</span>NioEndpoint.java:78<span class="token punctuation">)</span>
        at org.apache.tomcat.util.net.Acceptor.run<span class="token punctuation">(</span>Acceptor.java:129<span class="token punctuation">)</span>
        at java.lang.Thread.run<span class="token punctuation">(</span>java.base@11.0.12/Thread.java:829<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="_2-2-스택-정보를-이용한-성능-분석"><a href="#_2-2-스택-정보를-이용한-성능-분석" class="header-anchor">#</a> 2.2 스택 정보를 이용한 성능 분석</h3> <ul><li>스택 정보는 성능 저하나 멈춤 상태에서 프로세스를 분석하는 핵심 정보다.</li></ul> <h4 id="_2-2-1-스택-대기-분석"><a href="#_2-2-1-스택-대기-분석" class="header-anchor">#</a> 2.2.1 스택 대기 분석</h4> <ul><li><code>- locked</code> 면 락을 잡았다는 의미</li> <li><code>- waiting to lock</code> 은 다른 스레드가 사용할 락을 잡고 있어 대기하고 있다는 의미</li></ul> <h4 id="_2-2-2-교착상태"><a href="#_2-2-2-교착상태" class="header-anchor">#</a> 2.2.2 교착상태</h4> <h4 id="_2-2-3-스택-성능-분석"><a href="#_2-2-3-스택-성능-분석" class="header-anchor">#</a> 2.2.3 스택 성능 분석</h4> <h3 id="_2-3-스택-수집"><a href="#_2-3-스택-수집" class="header-anchor">#</a> 2.3 스택 수집</h3> <ul><li>자바 프로그램의 스택 정보 수집</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>jstack <span class="token punctuation">[</span>pid<span class="token punctuation">]</span> // <span class="token punctuation">[</span>JDK <span class="token environment constant">HOME</span><span class="token punctuation">]</span>/bin 디렉터리에 있음
<span class="token function">kill</span> -3 <span class="token punctuation">[</span>pid<span class="token punctuation">]</span> // 표준 출력으로 스레드 덤프를 출력
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>자바 힙 덤프 설정
<ul><li>자바 프로세스에서 아래와 같이 설정이 추가돼 있으면 <code>kill -3</code> 시그널에서 힙 덤프가 생성된다.</li></ul></li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>-XX:+HeapDumpOnCtrlBreak
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_2-4-프로세스-스택-분석-도구"><a href="#_2-4-프로세스-스택-분석-도구" class="header-anchor">#</a> 2.4 프로세스 스택 분석 도구</h3> <h4 id="_2-4-1-환경설정"><a href="#_2-4-1-환경설정" class="header-anchor">#</a> 2.4.1 환경설정</h4> <h4 id="_2-4-2-주요-기능-설명"><a href="#_2-4-2-주요-기능-설명" class="header-anchor">#</a> 2.4.2 주요 기능 설명</h4> <h4 id="_2-4-3-sdpa를-이용한-성능-분석"><a href="#_2-4-3-sdpa를-이용한-성능-분석" class="header-anchor">#</a> 2.4.3 SDPA를 이용한 성능 분석</h4> <h2 id="_3-통신-파일-상태"><a href="#_3-통신-파일-상태" class="header-anchor">#</a> 3. 통신/파일 상태</h2> <h3 id="_3-1-파일-지시자의-이해"><a href="#_3-1-파일-지시자의-이해" class="header-anchor">#</a> 3.1 파일 지시자의 이해</h3> <p><img src="/assets/img/img.7d5892ad.png" alt=""></p> <p><img src="/assets/img/img_1.a96053d6.png" alt=""></p> <ul><li>유닉스와 리눅스는 소켓이나 파일을 사용할 때 파일 지시자(FD)라는 것을 사용한다.</li> <li>유닉스에서 파일 지시자는 파일 뿐만 아니라 디렉토리, 디바이스, 파이프, 네트워크 소켓, 유닉스 도메인 소켓 등에 접근할 떄도 사용된다.</li> <li>유닉스 프로세스 FD 상태 정보는 pfiles ,lsof 명령을 통해 조회할 수 있다.</li></ul> <h3 id="_3-2-연계-통신-파일-상태-정보를-수집하는-방법"><a href="#_3-2-연계-통신-파일-상태-정보를-수집하는-방법" class="header-anchor">#</a> 3.2 연계 통신/파일 상태 정보를 수집하는 방법</h3> <ul><li><code>lsof -p [pid]</code> 로 대상 프로세스의 상태를 조회할 수 있다.</li></ul> <h2 id="_4-통신-파일-간-동작"><a href="#_4-통신-파일-간-동작" class="header-anchor">#</a> 4. 통신/파일 간 동작</h2> <h3 id="_4-1-시스템-콜에-대한-이해"><a href="#_4-1-시스템-콜에-대한-이해" class="header-anchor">#</a> 4.1 시스템 콜에 대한 이해</h3> <ul><li>스택 정보와 통신/파일 상태 정보는 시점 정보이기 때문에 파일을 계속 열고 있지 않고 순간적으로 여닫는 경우는 잡히지 않을 수도 있다.</li> <li>이러한 정보를 얻기 위해서는 시스템 콜을 모니터링 해야 한다.</li> <li>유닉스나 리눅스는 C언어를 기반으로 개발되어 시스템 콜에 보이는 함수가 C로 개발된 시스템 라이브러리에서 제공되는 함수이다.</li></ul> <h3 id="_4-2-통신-파일-상태와-동작-연계-분석"><a href="#_4-2-통신-파일-상태와-동작-연계-분석" class="header-anchor">#</a> 4.2 통신/파일 상태와 동작 연계 분석</h3> <h3 id="_4-3-스택-정보와-통신-파일-간-동작-연계-분석"><a href="#_4-3-스택-정보와-통신-파일-간-동작-연계-분석" class="header-anchor">#</a> 4.3 스택 정보와 통신/파일 간 동작 연계 분석</h3> <h3 id="_4-4-통신-파일-간-동작-모니터링-방법"><a href="#_4-4-통신-파일-간-동작-모니터링-방법" class="header-anchor">#</a> 4.4 통신/파일 간 동작 모니터링 방법</h3> <h2 id="_5-기타"><a href="#_5-기타" class="header-anchor">#</a> 5. 기타</h2> <h3 id="_5-1-프로그램-소스코드-보기"><a href="#_5-1-프로그램-소스코드-보기" class="header-anchor">#</a> 5.1 프로그램 소스코드 보기</h3> <h3 id="_5-2-바이너리-코어-덤프에서-자바-스택이나-힙-정보를-추출하는-방법"><a href="#_5-2-바이너리-코어-덤프에서-자바-스택이나-힙-정보를-추출하는-방법" class="header-anchor">#</a> 5.2 바이너리 코어 덤프에서 자바 스택이나 힙 정보를 추출하는 방법</h3> <h3 id="_5-3-프로세스의-현재-작업-디렉터리를-확인하는-법"><a href="#_5-3-프로세스의-현재-작업-디렉터리를-확인하는-법" class="header-anchor">#</a> 5.3 프로세스의 현재 작업 디렉터리를 확인하는 법</h3> <h3 id="_5-4-프로르램에서-사용하는-공유-라이브러리-확인"><a href="#_5-4-프로르램에서-사용하는-공유-라이브러리-확인" class="header-anchor">#</a> 5.4 프로르램에서 사용하는 공유 라이브러리 확인</h3> <h3 id="_5-5-프로세스-생성-관계-보기"><a href="#_5-5-프로세스-생성-관계-보기" class="header-anchor">#</a> 5.5 프로세스 생성 관계 보기</h3> <h3 id="_5-6-프로세스의-수행-환경-확인"><a href="#_5-6-프로세스의-수행-환경-확인" class="header-anchor">#</a> 5.6 프로세스의 수행 환경 확인</h3></div></div></div></div> <div data-v-52bca676></div></div></div></div> <footer prime="" class="v-footer mt-2 v-sheet theme--light v-footer--padless" style="background:#F3F5F7;"><div class="col col-12"><div class="text-center v-card v-card--flat v-sheet theme--light rounded-0" style="background:#F3F5F7;"><div class="v-card__text"><p>Copyright © 2021 All Right <em>끄적끄적 개발일지</em></p> <p>
          px201226@gmail.com .
          <a href="https://github.com/px201226" target="_blank">GitHub</a>
          .
          <a href="http://px201226.github.io/blog" target="_blank">Blog</a>
          .
        </p></div></div></div></footer></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.70752fd1.js" defer></script><script src="/assets/js/17.4dcf5890.js" defer></script><script src="/assets/js/16.8ebbd2f8.js" defer></script>
  </body>
</html>
