---
layout: post
title: "2장 - 데이터 모델과 질의 언어"
tags: 
 - 데이터 중심 애플리케이션 설계
lang: ko-KR
date: 2022-01-10
update: 2022-01-10
---

데이터  모델은 소프트웨어가 할 수 있는 일과 할 수 없는 일에 지대한 영향을 주므로 애플리케이션에 적합한 데이터 모델을 선택하는 작업은 상당히 중요하다.

<!-- more -->

# 관계형 모델과 문서 모델

- 오늘날 가장 장 알려진 데이터 모델은 관계형 모델을 기반으로 한 SQL 이다.
- 데이터는 **관계(relation)** 로 구성되고 각 관계는 순서 없는 **튜플(tuple)** 의 모음이다.

### NoSQL의 탄생

- 2010년대에 NoSQL은 관계형 모델의 우위를 뒤집으려는 가장 최신 시도이다.
- NoSQL 데이터베이스를 채택한 데는 다음과 같은 다양한 원동력이 있다.
    - 대규모 데이터셋이나 매우 높은 쓰기 처리량 달성을 관계형 데이터베이스보다 쉽게 할 수 있는 뛰어난 확장성의 필요
    - 상용 데이터베이스 제품보다 무료 오픈소스 소프트웨어에 대한 선호도 확산
    - 관계형 모델에서 지원하지 않는 특수 질의 동작
    - 관계형 스키마 제한에 대한 불만과 더욱 동적이고 표현력이 풍부한 데이터 모델에 대한 바람
    

### 객체 관계형 불일치

- 객체지향 프로그램에서 데이터를 관계형 테이블에 저장하려면 애플리케이션 코드와 데이터베이스 모델 객체 사이에 거추장스러운 전환 계층이 필요하다.
- 이런 모델 사이의 분리를 **임피던스 불일치(impedance mismatch)** 라고 부른다.
- 관계형 스키마로 표현한 이력서 예시
- 이력서 같은 데이터 구조는 모든 내용을 갖추고 있는 문서라서 JSON 표현에 매우 적합하다.
- 몽고DB, 링싱크DB, 카우치DB, 에스프레소 같은 문서 지향 데이터베이스는 JSON 데이터 모델을 지원한다.

### 다대일과 다대다 관계

- 관계형 데이터베이스 예시 그림에서 `region_id` 와 `industry_id`는 평문인 `“그레이터 시애틀 구역”` 과 `“자선활동”`이 아닌 ID로 주어졌다. 왜 일까?
- 지역과 업계의 표준 목록으로 드롭다운 리스트나 자동 완성 기능을 만들어 사용자가 선택하게 하는 데는 다음과 같은 장점이 있다.
    - 프로필 간 일관된 스타일과 철자
    - 모호함 회피 `(예를 들어 이름이 같은 여러 도시가 있는 경우)`
    - 갱신의 편의성, 이름이 한 곳에만 저장되므로 이름을 변경해야 하는 경우 전반적으로 갱신하기 쉽다.
    - 현지화 지원, 사이트를 다른 언어로 번역할 때 표준 목록을 현지화해 지역과 업계 사이트를 보는 사람의 언어로 표시할 수 있다.
    - 더 나은 검색
- ID나 텍스트 문자열의 저장 여부는 중복의 문제이다.
    - ID를 사용하게 되면 한 곳에만 저장하고 다른 곳에서 모두 참조를 한다.
    - 텍스트를 직접 저장한다면 그것을 사용하는 모든 레코드에서 정보를 중복해서 저장하게 된다.
- 중복된 데이터를 정규화하려면 **다대일 관계**가 필요하다.
    - 관계형 데이터베이스는 조인이 쉽기 때문에 ID로 다른 테이블의 로우를 참조하는 방식은 일반적이다.
    - 문서 모델에서 조인에 대한 지원이 약하기 때문에 다대일 관계는 적합하지 않다.
- 애플리케이션의 초기 버전이 조인 없는 문서 모델에 적합하더라도 애플리케이션 기능이 추가하면서 데이터는 점차 상호 연결되는 경향이 있다.
    - 이력서의 새로운 기능으로 한 사용자가 또 다른 사용자를 위해 추천서를 작성하는 기능을 넣는다고 해보자.
    - 추천서는 추천받은 사용자 이력서에는 추천인의 이름과 사진이 함께 보여진다.
    - 추천인이 자신의 프로필을 갱신한다면 추천인이 작성한 모든 추천서 역시 갱신되어야 한다.

### 문서 데이터베이스는 역사를 반복하고 있나?

- 1970년대 비지니스 데이터를 처리를 위해 가장 많이 사용한 데이터베이스는 **정보 관리 시스템(IMS)** 로 지금의 JSON 모델과 놀랍게도 비슷하다.
- 문서 데이터베이스처럼 IMS도 일대다 관계에서는 잘 동작한다.
- 하지만 다대다 관계표현은 어렵고 조인은 지원하지 않는다.
- 이러한 계층 모델의 한계를 해결하기 위해 관계형 모델과 네트워크 모델이 나왔다.

### 네트워크 모델

- 계층 모델의 트리 구조에서 모든 레코드는 정확하게 하나의 부모가 있다.
- 네트워크 모델에서 레코드는 다중 부모가 있을 수 있다.
- 네트워크 모델에서 레코드 간 연결은 프로그래밍 언어의 포인터와 유사하다.
- 레코드에 접근하는 유일한 방법은 최상위 레코드에서부터 연속된 연결 경로를 따르는 방법이다.
- 데이터베이스 질의와 갱신을 위한 코드가 복잡하고 유연하지 못한 문제가 있었다.

### 관계형 모델

- 관계형 모델이 하는 일은 알려진 모든 데이터를 배치하는 것이다.
- 관계형 데이터베이스에서 질의 최적화기(query optimizer)는  질의의 어느 부분을 어떤 순서로 실행할지를 결정하고 사용할 색인을 자동으로 결정한다.
- 질의 최적화기를 한번 만들면 데이터베이스를 사용하는 모든 애플리케이션이 혜택을 받을 수 있다.

### 문서 데이터베이스와의 비교

- 문서 데이터베이스는 별도의 테이블이 아닌 상위 레코드 내에 중첩된 레코드를 저장한다.
- 하지만 다대일과 다대다 관계를 표현할 때 관계형 데이터베이스와 문서 데이터베이스는 근본적으로 다르지 않다. 둘 다 관련 항목은 고유한 식별자로 참조한다.
- 관계형 모델에서는 **외래 키**라 부르고 문서 모델에서는 **문서 참조**라 부른다.

### 관계형 데이터베이스와 오늘날의 문서 데이터베이스

- 문서 데이터 모델을 선호하는 이유는 스키마 유연성, 지역성에 기인한 더 나은 성능때문이고, 일부 애플리케이션의 경우 애플리케이션에서 사용하는 데이터 구조와 더 가깝기 때문이다.
- 관계형 모델은 조인, 다대일, 다대다 관계를 더 잘 지원함으로써 문서 데이터 모델에 대항한다.

### 어떤 데이터 모델이 애플리케이션 코드를 더 간단하게 할까?

- 애플리케이션에서 데이터가 문서와 비슷한 구조`(일대다 관계 트리로 보통 한 번에 전체 트리를 적재)`라면 문서 모델을 사용하는 것이 좋다.
- 문서 모델의 제한은 문서 내 중첩 항목을 바로 참조할 수 없어서 `"사용자 251의 직위 목록의 두 번쨰 항목"`과 같이 표현해야 한다.
- **애플리케이션에서 다대다 관계를 사용한다면 관계형 모델이 적합하다.**
- 비정규화로 조인의 필요성이 줄이기가 가능하지만 애플리케이션 코드는 비정규화된 데이터의 일관성을 유지하기 위해 추가 작업을 해야한다.
- 일반적으로 어떤 데이터 모델이 애플리케이션 코드를 더 간단하게 만드는지 말할 수 없다.
- 상호 연결이 많은 데이터의 경우 그래프 모델은 매우 자연스럽다.

### 문서 모델에서의 스키마 유연성

- 대부분의 문서 데이터베이스와 관계형 데이터베이스에서 지원하는 JSON은 문서의 데이터에 어떤 스키마를 강요하지 않는다.
- 스키마가 없다는 뜻은 임의의 키와 값을 문서에 추가할 수 있고 읽을 때 클라이언트는 문서에 포함된 필드의 존재 여부를 보장하지 않는다는 의미다.
- 문서 데이터베이스는 종종 스키마리스(schemaless)로 불리지만 데이터베이스가 이를 강요하지 않을 뿐, 암묵적인 스키마`(쓰기 스키마, 읽기 스키마)`가 존재한다.
- 읽기 스키마는 프로그래밍 언어에서 동적 타입 확인과 유사하고 쓰기 스키마는 정적 타입 확인과 비슷하다.
- 읽기 스키마 접근 방식은 컬렉션 안의 항목이 어떤 이유로 모든 동일한 구조가 아닐 때 유용하다.

### 정리

- 역사적으로 데이터를 하나의 큰 트리(계층 모델)로 표현하려고 노력했지만 다대다 관계를 표현하기에는 트리 구조가 적절하지 않았다.
- 이 문제를 해결하기 위해 관계형 모델이 고안됐다.
- 최근에는 관계형 모델에도 적합하지 않은 애플리케이션이 있다는 사실을 발견했고 새롭게 등장한 비관계형 데이터저장소인 NoSQL은 다음과 같은 두 가지 주요 갈래가 있다.
    - `문서 데이터베이스`는 데이터가 문서 자체에 포함돼 있으면서 하나의 문서와 다른 문서 간 관계가 거의 없는 사용 사례를 대상으로 한다.
    - `그래프 데이터베이스`는 문서 데이터베이스와는 정반대로 모든 것이 잠재적으로 관련 있다는 사용 사례를 대상으로 한다.
- 한 모델을 다른 모델로 흉내 낼 수 있지만, 대부분 엉망이다. 각기 목적에 맞는 다양한 시스템을 보유해야 된다.
- 문서 및 그래프 데이터베이스가 가진 공통점 중 하나는 일반적으로 저정할 데이터를 위한 스키마를 강제하지 않아 변화하는 요구사항에 맞춰 애플리케이션을 쉽게 변경할 수 있다는 점이다.